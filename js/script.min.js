const testData='[{"country":"Россия","cities":[{"city":"Красноярск","coordinates":[56.010569,92.852572],"objects":[{"name":"Офис КРАСНОЯРСК","manager":"Лягушкин Иван Сергеевич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[56.014193,92.8588]},{"name":"Офис КРАСНОЯРСК ЦЕНТР","manager":"Зубенко Михаил Петрович","phoneNumbers":["+79992222222","+79992222222","+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[56.061124,92.968782]}]},{"city":"Норильск","coordinates":[69.357041,88.186171],"objects":[{"name":"Офис Норильск 8","manager":"Калугина Ева Владиславовна","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[69.343989,88.213558]},{"name":"Офис Норильск Главный","manager":"Петров Арсений Михайлович","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[69.340358,88.22605]}]},{"city":"Москва","coordinates":[55.7522,37.6156],"objects":[{"name":"Офис Москва","manager":"Кудряшов Алексей Георгиевич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.756113,37.59536]},{"name":"Офис Москва 1","manager":"Сальникова Анна Львовна","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.631449,37.762387]},{"name":"Офис Москва 3","manager":"Павлова Любовь Ярославовна","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.800326,37.707938]}]},{"city":"Екатеринбург","coordinates":[56.8519,60.6122],"objects":[{"name":"Офис Екатеринбург 1","manager":"Зотов Илья Юрьевич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[56.817075,60.543707]},{"name":"Офис Екатеринбург 2","manager":"Миронов Михаил Ильич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[56.889012,60.608307]}]},{"city":"Владикавказ","coordinates":[43.0367,44.6678],"objects":[{"name":"офис Владикавказ","manager":"Муратов Руслан Александрович","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[43.053311,44.649789]}]}]},{"country":"Белоруссия","cities":[{"city":"Минск","coordinates":[53.9,27.5667],"objects":[{"name":"Офис МИНСК","manager":"Иванова Софья Марковна","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[53.899664,27.554764]},{"name":"Офис МИНСК ЦЕНТР","manager":"Зубкова Вероника Никитична","phoneNumbers":["+79992222222","+79992222222","+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[53.952568,27.615491]}]},{"city":"Брест","coordinates":[52.0975,23.6877],"objects":[{"name":"Офис БРЕСТ","manager":"Свешникова Эмилия Ивановна","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[52.092418,23.725233]}]},{"city":"Витебск","coordinates":[55.1904,30.2049],"objects":[{"name":"Офис ВИТЕБСК","manager":"Елисеев Иван Николаевич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.173768,30.153316]},{"name":"Офис ВИТЕБСК 2","manager":"Тихомиров Савелий Никитич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.196586,30.252575]}]},{"city":"Полоцк","coordinates":[55.4879,28.7856],"objects":[{"name":"Офис Полоцк 1","manager":"Макаров Максим Дмитриевич","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.485139,28.804243]},{"name":"Офис Полоцк 2","manager":"Петров Михаил Иванович","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[55.499229,28.753994]}]},{"city":"Светлогорск","coordinates":[52.6329,29.7389],"objects":[{"name":"Офис Светлогорск","manager":"Фомичев Станислав Иванович","phoneNumbers":["+79992222222","+79992222222"],"email":"username@flagstudio.ru","coordinates":[52.627032,29.731153]}]}]}]';function init(){var e=new ymaps.Map("map",{center:[56.01,92.85],zoom:6,controls:[]});const t=JSON.parse(testData);let a=[];for(let e=0;e<t.length;e++)a[e]=o(t[e],e);function o(t,a){let o=[],r=document.createElement("div");return r.className="country",r.id="country-"+a,r.innerHTML=t.country,r.onclick=function(t){c(t.target.id.replace("country-","")),e.setBounds(e.geoObjects.getBounds()),e.getZoom()>6&&e.setZoom(6)},function(t,a,o){if(!t)return;let r=document.createElement("div");r.className="country-data",r.id="countryData-"+a;for(let a=0;a<t.length;a++){let c=new ymaps.Clusterer({preset:"islands#invertedBlueClusterIcons",clusterIcons:[{href:"./img/placemark.svg",size:[40,40],offset:[-20,-20]}],groupByCoordinates:!1,clusterDisableClickZoom:!0,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1});c.events.add("click",function(t){var a=t.get("target");e.setCenter(a.geometry.getBounds()[0]),void 0===a.getGeoObjects&&e.getZoom()<12&&e.setZoom(12)});let i=document.createElement("details");i.className="city",i.innerHTML=`<summary class="city-name">${t[a].city}</summary>`,i.append(s(t[a].objects,c)),i.addEventListener("toggle",e=>n(e,c,t[a])),i.onclick=function(){},r.append(i),o[a]=c}document.querySelector(".sidebar").append(r)}(t.cities,a,o),document.querySelector(".countries").append(r),o}function n(t,a,o){t.target.open?(o.coordinates?e.setCenter(o.coordinates,6):(e.setCenter([63,92],5),console.log(0===a.getClusters().length)),0!==a.getClusters().length?(a.balloon.open(a.getClusters()[0]),e.setCenter(a.getClusters()[0].geometry.getBounds()[0],6)):(e.setCenter(a.getGeoObjects()[0].geometry.getBounds()[0],6),e.getZoom()<12&&e.setZoom(12),a.getGeoObjects()[0].balloon.open(a.getGeoObjects()[0])),document.querySelectorAll(".country-data > details[open]").forEach(e=>{e!==t.target&&(e.open=!1)})):0!==a.getClusters().length?a.balloon.close(a.getClusters()[0]):a.getGeoObjects()[0].balloon.close(a.getGeoObjects()[0])}function s(e,t){let a=document.createElement("ul");a.className="offices-list";for(let o=0;o<e.length;o++){let n=document.createElement("li");if(n.className="office",r(n,e[o].name,`<div class="office-name">${e[o].name}</div>`),r(n,e[o].manager,`<div class="manager-name">${e[o].manager}</div>`),e[o].phoneNumbers&&0!==e[o].phoneNumbers.length){let t='<div class="phone-numbers">',a=/(\+7|8)[\s(]?(\d{3})[\s)]?(\d{3})[\s-]?(\d{2})[\s-]?(\d{2})/g;for(let n of e[o].phoneNumbers)t+=`<a class="phone" href="tel:${n}">${n.replace(a,"+7($2) $3-$4-$5")}</a>`;t+="</div>",n.insertAdjacentHTML("beforeend",t)}if(r(n,e[o].email,`<a class="email" href="mailto:${e[o].email}">${e[o].email}</a>`),a.append(n),e[o].coordinates){let a=new ymaps.Placemark(e[o].coordinates,{balloonContent:n.outerHTML,clusterCaption:"Объект "+(Number(o)+1)},{iconLayout:"default#image",iconImageHref:"./img/placemark.svg",iconImageSize:[20,20],iconImageOffset:[-10,-10]});t.add(a)}}return a}function r(e,t,a){t&&0!==t.length&&e.insertAdjacentHTML("beforeend",a)}function c(t){let o=document.getElementById("country-"+t),n=document.getElementById("countryData-"+t);o.classList.contains("active")||(!function(){const t=document.querySelectorAll(".country"),a=document.querySelectorAll(".country-data");for(let e=0;e<t.length;e++)t[e].classList.remove("active"),void 0!==a[e]&&a[e].classList.remove("active");e.geoObjects.removeAll()}(),a[t].map(t=>{e.geoObjects.add(t)}),o.classList.add("active"),n&&n.classList.add("active"))}c(0),e.setBounds(e.geoObjects.getBounds())}ymaps.ready(init);